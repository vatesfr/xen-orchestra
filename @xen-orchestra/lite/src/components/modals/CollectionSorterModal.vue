<template>
  <UiModal @submit.prevent="handleSubmit">
    <ConfirmModalLayout>
      <template #default>
        <div class="form-widgets">
          <FormWidget :label="$t('sort-by')">
            <select v-model="newSortProperty">
              <option v-if="!newSortProperty" />
              <option v-for="(sort, property) in availableSorts" :key="property" :value="property">
                {{ sort.label ?? property }}
              </option>
            </select>
          </FormWidget>
          <FormWidget>
            <select v-model="newSortIsAscending">
              <option :value="true">{{ $t('ascending') }}</option>
              <option :value="false">{{ $t('descending') }}</option>
            </select>
          </FormWidget>
        </div>
      </template>

      <template #buttons>
        <ModalDeclineButton />
        <ModalApproveButton>{{ $t('add') }}</ModalApproveButton>
      </template>
    </ConfirmModalLayout>
  </UiModal>
</template>

<script lang="ts" setup>
import FormWidget from '@/components/FormWidget.vue'
import ConfirmModalLayout from '@/components/ui/modals/layouts/ConfirmModalLayout.vue'
import ModalApproveButton from '@/components/ui/modals/ModalApproveButton.vue'
import ModalDeclineButton from '@/components/ui/modals/ModalDeclineButton.vue'
import UiModal from '@/components/ui/modals/UiModal.vue'
import { IK_MODAL } from '@/types/injection-keys'
import type { NewSort, Sorts } from '@/types/sort'
import { inject, ref } from 'vue'

defineProps<{
  availableSorts: Sorts
}>()

const newSortProperty = ref()
const newSortIsAscending = ref<boolean>(true)

const modal = inject(IK_MODAL)!

const handleSubmit = () => {
  modal.approve<NewSort>({
    property: newSortProperty.value,
    isAscending: newSortIsAscending.value,
  })
}
</script>

<style lang="postcss" scoped>
.form-widgets {
  display: flex;
  gap: 1rem;
}
</style>
