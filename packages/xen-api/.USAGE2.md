```js
import { Xapi } from 'xen-api'

// bare-bones XAPI client
const xapi = new Xapi({
  // URL to a host belonging to the XCP-ng/XenServer pool we want to connect to
  url: 'https://xen1.company.net',

  // credentials used to connect to this XAPI
  auth: {
    user: 'root',
    password: 'important secret password',
  },

  // if true, only side-effects free calls will be allowed
  readOnly: false,
})

// ensure that the connection is working
await xapi.checkConnection()

// call a XAPI method
//
// see available methods there: https://xapi-project.github.io/xen-api/
const result = await xapi.call(
  // name of the method
  'VM.snapshot',

  // list of params
  [vm.$ref, 'My new snapshot'],

  // options
  {
    // AbortSignal that can be used to stop the call
    //
    // Note: this will not stop/rollback the side-effects of the call
    signal,
  }
)

// after a call (or checkConnection) has succeed, the following properties are available

// list of classes available on this XAPI
xapi.classes

// timestamp of the last reply from XAPI
xapi.lastReply

// pool record of this XAPI
xapi.pool

// secret identifier of the current session
//
// it might become obsolete, in that case, it will be automatically renewed by the next call
xapi.sessionId

// invalidate the session identifier
await xapi.logOut()
```

```js
import { Proxy } from 'xen-api/proxy'

const proxy = new Proxy(xapi)

await proxy.VM.snapshot()
```

```js
import { Events } from 'xen-api/events'

const events = new Events(xapi)

// ensure that all events until now have been received and processed
await events.barrier()

// watch events on tasks and wait for a task to finish
const task = await events.waitTask(taskRef, { signal })

// for long running actions, it's better to use an async call which will are based on tasks
const result = await events.asyncCall(method)

const stop = events.watch(
  // class that we are interested in
  //
  // use `*` for all classes
  'pool',

  // called each time a new event for this class has been received
  //
  // https://xapi-project.github.io/xen-api/classes/event.html
  event => {
    stop()
  }
)

// when wanting to really stop watching all events, simply remove all watchers
events.clear()
```

```js
import { Cache } from 'xen-api/events'

const cache = new Cache(watcher)

const host = await cache.get('host', 'OpaqueRef:1c3f19c8-f80a-464d-9c48-a2c19d4e4fc3')

const vm = await cache.getByUuid('VM', '355ee47d-ff4c-4924-3db2-fd86ae629676')

cache.clear()
```
